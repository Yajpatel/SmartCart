{% extends 'base.html' %}
{% load static %}

{% block title %}
    {% if query %}
        Search Results for "{{ query }}" on {{ source|title }}
    {% else %}
        Featured Products
    {% endif %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'home.css' %}">
{% endblock %}

{% block content %}
<main class="content">
    
    {% if query %}
        <h2>Search Results for: "{{ query }}" on <span class="source-name">{{ source|title }}</span></h2>
        {% if scraped_products %}
            <div class="product-grid">
                {% for product in scraped_products %}
                    <div class="product-card">
                        <a href="{% url 'product_detail' encoded_url=product.encoded_url %}" class="product-main-link">
                            <div class="product-image-container">
                                <img src="{{ product.image_url }}" alt="{{ product.title }}" class="product-image" onerror="this.style.display='none'">
                            </div>
                            <div class="product-info">
                                <h4 class="product-title">{{ product.title|truncatechars:70 }}</h4>
                                <p class="product-price">{{ product.price|default:"N/A" }}</p>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No products were found on {{ source|title }} for your search. Please try another term.</p>
        {% endif %}

    {% else %}
        <h2>Featured Products from Amazon</h2>
        {% if categorized_products %}
            {% for category, products in categorized_products.items %}
                <h3 class="category-title">{{ category }}</h3>
                <div class="product-grid">
                    {% for product in products %}
                        <div class="product-card">
                            <a href="{% url 'product_detail' encoded_url=product.encoded_url %}" class="product-main-link">
                                <div class="product-image-container">
                                    <img src="{{ product.image_url }}" alt="{{ product.title }}" class="product-image" onerror="this.style.display='none'">
                                </div>
                                <div class="product-info">
                                    <h4 class="product-title">{{ product.title|truncatechars:70 }}</h4>
                                    <p class="product-price">{{ product.price|default:"N/A" }}</p>
                                </div>
                            </a>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        {% endif %}
    {% endif %}
</main>
{% endblock %}